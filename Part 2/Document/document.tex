\documentclass[a4paper]{article}
\usepackage{graphicx}
\usepackage{float}
\author{Hein van Beers \qquad Student number: 0765658 \\{\tt h.a.v.beers@student.tue.nl}\\ \\ Jeroen van Hoof \qquad Student number: 0778486 \\{\tt j.m.a.p.v.hoof@student.tue.nl}}
\title{Automated Reasoning\\
	 \large Practical assignment, Part II}
\begin{document}
	\maketitle
	
	\section*{Problem 1: Non-self-supporting Villages}
	Three non-self-supporting villages A, B and C in the middle of nowhere consume one food package each per time unit. The required food packages are delivered by a truck, having a capacity of 300 food packages. The locations of the villages are given, together with the number of time units it takes the truck to travel from one village to another, including loading or delivering. The truck has to pick up its food packages at location S containing an unbounded supply. The villages only have a limited capacity to store food packages: for A and B this capacity is 120, for C it is 200.
	
	\subsection*{Solution:}
	We generalize this problem to $n$ villages and a truck capacity of $C$. We also have a variable $m$ which represents the amount of steps we perform in the model. Each step corresponds to a change in the position of the truck. For each village we then introduce $n * (m+2)$ integer variables $vi\_j$ for $i=1,...,n$ and $j=0,...,m+1$, where $i$ indicates the number of each village and $j$ is the number of steps that have been performed. So now we have a variable $vi\_j$ that represents the amount of food packages in village $i$ after $j$ steps have been performed. Next, we also introduce $m+2$ integer variables $p_j$, $t_j$ and $d_j$ for $j=0,...,m+1$, where $p_j$ represents the position of the truck after $j$ number of steps have been performed, $t_j$ represents the load of the truck after $j$ number of steps have been performed, and $d_j$ represents the amount of food packages that are being delivered at step $j$.\\
	
	Since for each village $i$ the food capacity $vi\_j$ may not exceed its maximum capacity $max_i$, neither may get below zero for any step $j$, we introduce the following formula
\[ \bigwedge_{j=0}^{m+1} \bigwedge_{i=1}^n (vi\_j >= 0) \wedge (vi\_j <= max_i).\]
Where $max_i$ is the maximum capacity of village $i$. In the table below you can see the maximum capacities of villages A, B and C, together with their corresponding integer values.

\begin{table}[H]
\centering
\caption{Maximum capacities of each village}
\label{my-label}
\begin{tabular}{c|c|c}
\textbf{Village} & \textbf{Corresponding $i$} & \textbf{Maximum capacity} \\ \hline
A	&	1	&	120\\ \hline
B	&	2	&	120\\ \hline
C	&	3	&	200
\end{tabular}
\end{table}

	As prittles and crottles are not allowed to be put in the same truck, that is, for every two distinct positions $j,m$ in truck $i$ it is not allowed that both $p_{ij2}$ and $p_{im4}$ are true. This is expressed by the formula
\[ \bigwedge_{i=1}^n (\neg (\bigvee_{j=1}^8 p_{ij2}) \vee \neg (\bigvee_{m=1}^8 p_{im4})).\]

Next we assume that the first two trucks are cooled, so pallets of skipples cannot be placed in trucks 3 upto and including $n$. We express this by the formula
\[ \bigwedge_{i=3}^n \bigwedge_{j=1}^8 \neg p_{ij3}.\]

No two pallets of the type dupples may be placed in the same truck, that is, for every two distinct positions $j,m$ in truck $i$ it is not allowed that both $p_{ij5}$ and $p_{im5}$ are true. This is expressed by the formula
\[ \bigwedge_{i=1}^n \bigwedge_{j,m:1 \leq j < m \leq 8} \neg p_{ij5} \vee \neg p_{im5}.\]

Similarly, we also need the requirement that at most one variable is set to true per pallet position in a truck. So for every two distinct pallet types $k,m$ on position $j$ in truck $i$ it is not allowed that both $p_{ijk}$ and $p_{ijm}$ are true. This is expressed by the formula
\[ \bigwedge_{i=1}^n \bigwedge_{j=1}^8 \bigwedge_{k,m:1 \leq k < m \leq 5} \neg p_{ijk} \vee \neg p_{ijm}.\]

Finally, we consider the requirements of the demands. As the amount of pallets that need to be delivered for each pallet type is given, except for the prittles, we can express this by the formula
\[ \bigwedge_{k=1}^5 ( \sum_{i=1}^n ( \sum_{j=1}^8 f(p_{ijk}) ) = a_k).\]
Where $f(p_{ijk}) = 1$ if $p_{ijk}$ is equal to true and 0 otherwise. And $a_k$ is the amount of a pallets of type $k$ that need to be delivered. In the table below you can see the amount for each type of pallet.

\begin{table}[H]
\centering
\caption{Demand of each type of pallets}
\label{my-label}
\begin{tabular}{c|c|c}
\textbf{Pallet type} & \textbf{Corresponding k} & \textbf{Demand (pallets)} \\ \hline
Nuzzles              & 1                        & 4                  		\\ \hline
Prittles             & 2                        & ?                  		\\ \hline
Skipples             & 3                        & 8                 		\\ \hline
Crottles             & 4                        & 10                 		\\ \hline
Dupples              & 5                        & 5                 
\end{tabular}
\end{table}

For getting the answer to the maximization problem, we just try different values for the amount of pallets of prittles that need to be delivered and see if we get a solution. When we find a solution for a value $x$ for the amount of prittles that we deliver and we cannot find a solution for value $x+1$, we know that $x$ is the maximum number of pallets of prittles that can be delivered.\\

After trying several values, we found that 18 pallets of prittles is the maximum amount we can deliver, since the program does not yield a solution for 19 pallets of prittles.\\

The total formula now consists of the conjunction of all these ingredients, that is,
\[ \bigwedge_{i=1}^n (\sum_{k=1}^5 (\sum_{j=1}^8 (p_{ijk}*w_k)) \leq 7800) \;\; \wedge \]
\[ \bigwedge_{i=1}^n (\neg (\bigvee_{j=1}^8 p_{ij2}) \vee \neg (\bigvee_{m=1}^8 p_{im4})) \;\; \wedge \]
\[ \bigwedge_{i=3}^n \bigwedge_{j=1}^8 (\neg p_{ij3}) \;\; \wedge \]
\[ \bigwedge_{i=1}^n \bigwedge_{j,m:1 \leq j < m \leq 8} (\neg p_{ij5} \vee \neg p_{im5}) \;\; \wedge \]
\[ \bigwedge_{i=1}^n \bigwedge_{j=1}^8 \bigwedge_{k,m:1 \leq k < m \leq 5} (\neg p_{ijk} \vee \neg p_{ijm}) \;\; \wedge \]
\[ \bigwedge_{k=1}^5 ( \sum_{i=1}^n ( \sum_{j=1}^8 p_{ijk} ) = a_k) \]


This formula is easily expressed in SMT syntax, for instance, for $n=6$ one can generate

{\footnotesize

{\tt (benchmark Assignment1.smt}

{\tt :logic QF\_LIA}

{\tt :extrapreds (}

{\tt ;Truck 1 }

{\tt (p111) (p112) (p113) (p114) (p115) }

{\tt (p121) (p122) (p123) (p124) (p125) }

{\tt (p131) (p132) (p133) (p134) (p135) }

{\tt (p141) (p142) (p143) (p144) (p145) }

{\tt (p151) (p152) (p153) (p154) (p155) }

{\tt (p161) (p162) (p163) (p164) (p165) }

{\tt (p171) (p172) (p173) (p174) (p175) }

{\tt (p181) (p182) (p183) (p184) (p185) }

{\tt ;Truck 2 }

{\tt (p211) (p212) (p213) (p214) (p215) }

{\tt (p221) (p222) (p223) (p224) (p225) }

$\cdots \cdots$

{\tt )}

{\tt :formula}

{\tt   (and}

{\tt (<= (+ }

{\tt (* (ite p111 1 0) 700) $\cdots$ (* (ite p181 1 0) 700)}

{\tt (* (ite p112 1 0) 800) $\cdots$ (* (ite p182 1 0) 800)}

$\cdots \cdots$

{\tt (* (ite p115 1 0) 100) $\cdots$ (* (ite p185 1 0) 100)}

{\tt ) 7800)}

$\cdots \cdots$

{\tt (or }

{\tt (not (or p112 p122 p132 p142 p152 p162 p172 p182)) }

{\tt (not (or p114 p124 p134 p144 p154 p164 p174 p184)) }

{\tt ) }

$\cdots \cdots$

{\tt )) }
}

	\subsection*{Problem 1a}
	We need to show that it is impossible to deliver food packages in such a way that each of the villages consumes one food package per time unit forever.
	
	\subsection*{Problem 1b}

		%Als er een loop is en we vinden binnen aantal stappen een en in die loop is het mogelijk om te blijven deliveren en je komt in precies dezelfde states weer terug, dan kunnen we oneindig doorgaan.
	For this question we need to show that with a truck capacity of 320 food packages, it is possible to deliver food packages in such a way that the villages consume each one food package per time unit forever.
	
	To solve problems \textbf{b} and \textbf{c}, we need to find a loop that includes a finite amount of legal states. Once we find such a loop, we can repeat it infinitely, and conclude that it is possible to deliver food packages in such a way that each of the villages consumes one food package per time unit forever.
	
	Take two states $i$ and $j$, and take $n$ as the number of villages. Then two states are similar if and only if:
	$$similar(i, j) \Leftrightarrow p\_i = p\_j \wedge t\_i = t\_j \wedge \forall (k: 1 \leq k \leq n : vk\_i = vk\_j)$$
	
	A loop is defined as a set of succeeding states with a first state $S_i$ and last state $S_j$, where $S_i$ and $S_j$ are similar and $j > i$.
	
	So, if we take $m$ as the number of steps, a solution that holds a loop, can be defined with:
	%$$\exists (i, j: 0 \leq i,j \leq m \wedge j > i: similar(i, j))$$
	
	$$\bigvee_{i, j}^m j > i \wedge similar(i, j)$$
	
	We define a loop in smt as follows. For all $0 \leq i, j \leq m$ with $j > i$ we have {\tt (= p\_$i$ p\_$j$) (= t\_$i$ t\_$j$)}, and for each village $n$, we have: {\tt (= v$n$\_$i$ v$n$\_$j$)}.
	
	
	\subsection*{Problem 1c}
	Finally, we also need to check the same as for question 1b, but now with a truck capacity of 318 food packages.

Applying {\tt yices -m -smt Assignment1.smt} yields the following result
within a fraction of a second:

{\footnotesize

{\tt sat }

{\tt (= p185 false)}

{\tt (= p445 false)}

{\tt (= p213 true)}

{\tt (= p214 false)}

{\tt (= p452 false)}

{\tt (= p233 true)}

{\tt (= p435 false)}

{\tt (= p474 true)}

{\tt (= p623 false)}

{\tt (= p531 true)}

{\tt (= p662 false)}

$\cdots \cdots$ }

The values that are are true for each truck are 
\[p113, p125, p134, p143, p153, p163, p173, p183 \]
\[p213, p222, p233, p242, p255, p262, p272, p282 \]
\[p312, p322, p332, p342, p352, p362, p372, p382 \]
\[p414, p424, p444, p464, p474, p485 \]
\[p512, p525, p531, p541, p552, p562, p572, p582 \]
\[p611, p621, p634, p644, p665, p674, p684 \]
Expressed in a picture this yields



We check that indeed all requirements are satisfied and we also see that the amount of pallets of prittles we can deliver is 18, since the program does not yield a solution for 19 pallets of prittles.\\

{\bf Remark:}


{\bf Generalization:} 


	\section*{Problem 2: Placing components on a power grid}
	

	\subsection*{Solution:}
	
	
	\section*{Problem 3: Ordering jobs}



	\subsection*{Solution:}



{\bf Remark:}


{\bf Generalization:} 


\end{document}